28/10: Importance of user and group management
===============================================

to use for Configure tools Server side
--------------------------------------
 github
 maven/gradle
 jenkins/jenkinx #jenkinx for deticated for k8s
 nexus/jfrog
 docker daemons
 k8s
 grafana/promeheus
 jira
 ELK
 splunk
 kafka
 RABITMQ
 cloud/aws/azure
 
security (DevSecOps)
-----------
 Authentication.
 Authurization
 audit trail ?
 
Configuring security for CI/CD
-------------------------------
 to manage file permissions for deployment.
 to write or manage script , use user management
 Least Privilege principls - Each service in CI/CD shoul run least privilege to reduce risk
 hipaa #complience
 pam - Pluggable Authentication Modules
  /etc/pam.d/sshd → controls SSH logins
  /etc/pam.d/sudo → controls sudo access
  /etc/pam.d/system-auth → global defaults
 
Jenkins authenticated through LDAP

 linux system login profiles:
 ----------------------------
  Every user
  Any user
  whenever open a new terminal
  
   shell -login with shell
   System wide profile -  /etc/profiles
   user-specific profile -
   
   
   
   
16) 29/10:user management  
---------------------------
 super user
 normal user
 system user
 network user
 sudo user
 
 whoami
 
 user and group unique id
 -------------------------
 user id - uid
 groupid  -gid
 
 Redhat v7 user management
 -----------------------
  root user id     - 0
  Standard user id - 1 to 200
  Dynamic user id  - 201 to 999
  
  linux new user id  - starts from 1000 and belongs to 4 groups
   sudo su -
   whoami
   id root    # uid = 0 starts from 0 - root
   
 username and ids    #store is /etc/passwd
 users passwords     #/etc/shadow
 home directory and default shell will create automatically
 
 user created in server side mail box will be create #/var/spool/mail
 
 user environment variable files
  .bash_logout, .bash_profile, .bashrc    #these configuration files will copied from /etc/skell to new user
 
types of Ways to add new user
------------------------------
 useradd
 adduser
 newuser


adding new user  - grep #(global regular expression print)
-----------------------------------------------------------
  whoami
  useradd    #can add new user with sudo
  sudo su -
  useradd sudharsan
  id sudharsan             #find user with id. gid will add primary and secondary
  grep raghav /etc/passwd  #can also search user using grep . * global regular expression print
  vi /etc/passed    
   #sudharsan:x:1001:1001::/home/sudharsan:/bin/bash
    (username)
	 x - Encrypt form of passwords
	 1001:1001  -uid:gid
	 ::        -description
	 /home/...  - default home directory
	 /bash/bin   -default shell


  When tries to add new user configurations files are take from the directory
   => useradd --> /etc/default/useradd --> /etc/login.defs
  
  passwd sudharsan
  cat /etc/passwd    #sudharsan:x:1001:1001::/home/sudharsan:/bin/bash
   # x -encrypt form of password stored in to shadow file
  cat /etc/shadow
  whoami
  su sudharsan    #can switch any user from root privilage but environmental configurations files wont copy, 
                   so still it will take root privilage even for switch any other user
  whoami
  pwd
  exit
  su - sudharsan  # now the environmental config file will copy to this user, ls -la #bash_logout, bash_profile, bashrc
  pwd
  whoami
  id sudharsan
  ls -la          #bash_logout, bash_profile, bashrc - current user environment config files
  
  
 last          #will show last successful login
 lastb         #see bad attempts
 last man
 
 sudoers  - sudo users    #/etc/sudoers
 -----------------------------------------
 Provide sudo permission for the normal user without root password
 
   su - sudharsan        #can create new user without root
   sudo useradd raghav
   sudo passwd raghav
   su raghav
   
** sudharsan   ALL=(ALL:ALL) ALL
   sudharsan → username
   ALL → from any host
  (ALL:ALL) → can run commands as any user/group
   final ALL → can run any command
   
combination of root login
--------------------------
 su -
 su - root
 su root
 sudo su -
 
 useradd -c "devops" raghav      #-c argument, used to provide decription
 grep raghav /etc/passwd
 groupadd devops
 useradd -g devops -s /bin/bash -c"devops" -m -d /home/newuser newuser                
   #-g primary group G- secondary
   -m   #create home directory
   -d   #to set the home directory  -mandatory
   dir - /home/mewuser
   username - newuser
   
  grep newuser /etc/passwd     #to view user dir and group
  usermod -c "sysops" newuser
  
  useradd cloud
  usermod -g devops cloud
  grep cloud /etc/passwd
  
  man usermod
  usermod -l mrraghav raghav   #can set newuser name for existing username
  
create user with no login
-------------------------
 useradd -s /sbin/nologin mruser       #confiure user with no login
 grep mruser /etc/passwd
 passwd mruser
 su - mruser        #no login
 
 vi /etc/passwd
    #edit user dir /sbin/nologin to /bin/bash
 su - mruser  #can able to login
 
 userdel mruser        #delete user


Lock and unlock the user account
----------------------------------
 sudo passwd -l raghav    #to lock the traget user
 su - raghav
 
 sudo passwd -u raghav   #to unlock the target user
 su -raghav
 
password expiry
---------------
 sudo passwd -e raghav   #forced expiray passwd to target user
 
 sudo chage -l raghav    #to view credential details of the user
 sudo passwd -n 7 -x 30 -w 5 raghav           #Adjusting aging data of user
   #-n  - minimum no.of days to expire passwd
   #-x  - maximum no.of days to expire passwd
   #-w  - warning before passwd expire
  
  
***********user management*************


how to activate and deactivate shadow passwd file
how to check /etc/passwd file properly integrate or not
how to check all the fields under /etc/ -files are valid or not
   pwck - to  verify for check the integrity of passwd
   
can i create duplicate root user?
how to recover the user deleted mistakely

 pwconv
 pwunconv
 grpconv
 grpunconv
 
 
**to take the backup of shadow -  /etc/shadow-
**to take backup of user       -  /etc/passwd-
  
 
file saved locarion
---------------------
 users files save    - /etc/passwd
 users password      - /etc/shadow
 
 goups are saved in  - /etc/group
 groups password     - /etc/gshadow



17) 02/11  -
-----------------------

use su & sudo
----
 su  #if you need full root session
 sudo  #use of specific admin tasks without full root access
 
 
 sudo
 su    # substitute user or switch user including root but require passwd for target one
 sudo -i   #directly switch to root shell
 
user switch:  Su           sudo
password:    require 




20) 5/11/25 - How to implement sticky bit, setuid & gid:
========================================================
 sticky bit:
 ------------
  Prevent unauthorized deletion
  
  symbolic represent
  --------------------
   s - set/assign   #setuid 
   S -  "           #setgid
   t - asign
   T - remove
   1 - assign
   0 - remove sticky bit
   
    s - in the userfield
	S - in the groupfield
	t - in other field ---sticky bit
	
	
  sticky bit Permission:
 -----------------------
   4 - read
   2 - write
   1 - execute
   
   
  
create user and add into group
-------------------------------
 sudo su -
 groudadd linux     #create new gorup
 useradd x          #create new user
 useradd y
 useradd z
 
 usermod -aG linux x  #adding user into existing group
 usermod -aG linux y
 usermod -aG linux z
 
 cat /etc/group
 
 
create common direectory
------------------------
 mkdir common
 ls -ld
 ls -ld common       #common dir should not root
 chgrp linux common
 ls -ld common       #group doesnot have the write wrights
 chmod g+w common    # symbolic represent  - group + write permission 
 ls -ld common  
 chmod o+x /root     #others + executable permission in root
 ls -ld common
 
 
 su - x
 whoami
 cd /root/common
 chmod 1774 common    #sticky bit  - 1
 touch x1
 ls
 exit
 
 su - y
 cd /root/common
 rm x1               #cant remove 
 exit
 
 ls -ld common
 chmod -t common
 ls - ld common
 su - y
 rm x1               #can remove
 
 
 
 
 
21) file permissions - getfacl,setfacl
=======================================
 #Administrator can set the permission for specific users

 getfacl   #get all permission including acls
 setfacl   #set extra permissions
 chattr
 lsattr
 
 acl: accesss control list
 
 why do we need ?
 appart from Owner, group ,other user, set permissions to specific user
 
 multipl users need different permission on same  file


add a user and assign the permissuion
---------------------------------------
 sudo grep ec2-user /etc/passwd         # to search the user in passwd file
 ls -la /etc/passwd
 sudo vi /etc/passwd
 sudo useradd alice
 echo "hi" > secret.txt
 ls -l secret.txt                       #to view permission
 
 getfacl secret.txt                     #to view the permissio of the file
 setfacl -m u:alice:r-- secret.txt      # -m modifying u:username:read permission-- file.txt
 getfacl secret.txt
 
 sudo -u alice cat secret.txt     #trying to open a file as a alice
 setfacl -x u:alice secret.txt    #-x execute, remove permission for alice
 setfacl -b secret.txt            #remove the permission for all 
 getfacl secret.txt               #can see the updated permission
 
 setfacl -m u:alice:rw-- secret.txt  #assign the read and write permission
 getfacl secret.txt
 setfacl -m u:alice:--x secret.txt   #assign execute prmission
 getfacl secret.txt
 
 echo 'echo "hello DevOps" ' > secret.txt
 chmod +x secret.txt         #set execute permission to files
 sudo -u alice ./secret.txt  #to view the file    #will permission denied
 
 
 ***Even set write and execute permission for the setfacl, can't access the file***
    ----------------------------------------------------------------------------
	Need to change the file attribute  
    chattr +i  #immutable
    chattr -i  #mutable	
	chattr +a  #append
	chattr +s  #secure deletion
	chattr d   #notedown
	chattr e   #extend format
	lsattr     #list attribute of the specific file
	
    man lsattr 
	echo "hello" > demo.txt
	sudo chattr +i demo.txt     #+i -immutable. to change the attribute to immutable (cannot be modified)
	ls -l demo.txt
	
	echo "modifing the file" > demo.txt
	sudo echo "modify" >> demo.txt         
 #cannot modify the file untill change the attribute 		  
	
	sudo chattr -i demo.txt      #-i mutable. change the attribute to mutable
	sudo echo "modify" > demo.txt
	cat demo.txt
	
	sudo chattr +i demo.txt      #+i immutable
	sudo echo "modify" > demo.txt  #cant access 
	
	
 q: what is the differenc between the stickybit and setfacl
 
 
ulimit  -user limit
--------------------
-Types:
  soft limit 
  hard limit
  
 ulimit
 ulimit -a
 type ulimit
 ulimit -n
 ulimit -u
 ulimit -a
 lsns
  

 
23) 07/11   - Process Management
========================================================================
 
 Booting process
 ----------------
  bios / uefi
  bootloader
  copy the kernal to load in memory
  kernal initialize the os and create first process is called 
   init or systemd  [Modern OS ]
   pid of systemd is always 1 
   
 pstree     # 1st process - systemd
 pstree -p
 pidof systemd   #pi -print the process id
 ps- fp 2320
 ps -e | grep systemd   #-e  - everything
 systemctl --user status
 ps -lf          #-lf long list full format
   #F    - flask
    S    - process state
    UID
    PID
    c    - CPU process utilization
	PRI - Priority
	Ni  - Nize value
    ADDR - Memory address
	SZ   No.of pages
	WChan - Kernal related status
	ps -ef

    ps -u ec2-user                 #to view the process are attached to the particular user
    ps -eo comm,pcpu,pmem | head   #ps -eo -everything output commands,process CPU,
	pstree 
	ps -eo comm,pcpu --sort -pcpu | head
	
	ps -C ps -o pid=2830     #to view process ids are associate with ps
	ps -C ps -o pid=
	ps -C bash -o pid=
	
	ps -eo pid,cmd e | tail -n 3   #e - environment variable
	
	
 Need to see:
  userid?
  effectiveID?
  id?
    

24) 10/1125
========================
 last class:
  what is process
 what is program
 diff between process and program
 what is scheduler
 what are the diff process states
 what are the diff types of processes:
  zombie
  orphan
  daemon process
 what is process control table

what is the initd or system process
pstree command 

pidof command
how to view the process usinf ps with various arguments

running instance of a program
==============================
 own memory, cpu contex, file description, environments and system resource.
 
 ls --> create the process from -> /bin/ls
  pid,ppid
  
  
what happened when process is created
----------------------------------------  

 1. parent process request a new process - fork
    ps
	bash is the parent process for every commands
	
 2. Every process request new process
    
	kernal -> pcb ->#pcb contains - pid,process state, pc, cpu, register memory mappring,   #pcb - process control block
	
 3. Kernal duplicate the parent resources
    
	copy-on-write--cow  -> copy the file descripter
	
	New process Request
	 pid -> ppid -> kernal -> # kernal will create memory pages
	
	One tryse to modify the copy process will create
	
 4. both parent and child will resume
	
	
 
 
 
 ls       # every command process, process id will create
 echo $$  #print the current process id
 ls
 echo $$  #another process id will create
 
 
strace - system call how internally communication, it will perform deep scan.
--------------------------------------------------------------------------------
 type strace
 man strace
 
 echo $?  #to see executed command state
  0       #0 - success
  
 sudo yum insatll -y docker
 sudo systemctl strat docker
 pgrep dockerd               #we can able to see pid with pname
 sudo strace -f 28179        # cannot find ....
 sudo strace -f dockerd
 
 ps -ef | wc -1         #wc - word count
 ps -ef | grep dockerd
 
 man kill
 kill -l
 kill -l | grep sig
 
slepp:
---------

 man sleep 
 sleep 10000&        # to set a sleep time for a specific process, 10000& - sleep, it will run in background
 sleep 20000&         # 20000& - sleep time
 sleep 20000&         # total three process will create 
 ps
 jobs -l            #list the background sleeping process
 fg 3               #foreground 3rd process
 sleep 30000&       
 fg 3 
    #ctrl z - will stop the current fg process and exit
	#ctrl c - exit
	
 kill %3         # kill process with job id
 jobs -l
 kill 28755      #kill with process id
 jobs -l
 pkill sleep     #kill with process name 
 jobs -l 
 
 sleep 10000&
 sleep 20000&
 sleep 30000&
 killall sleep    #it will kill all the process with process id
 
 sudo kill -9 1   #force kill with job id, kill -9 with job id
 top
 slepp 20000&
 ps
 kill -9 28920    #kill -9 - pause the signal in the intenal
 ps
 
 ps --forest      #display the process in the tree format
 ps --no-headers
 ps
 
 
 
 
 

	
 

 
 
 
  
  
 
 
